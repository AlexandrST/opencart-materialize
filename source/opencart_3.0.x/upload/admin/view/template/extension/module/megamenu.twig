{{ header }}{{ column_left }}
<div id="content">
	<div class="page-header">
		<div class="container-fluid">
			<h1>{{ megamenu_title }}</h1>
			<ul class="breadcrumb">
				{% for breadcrumb in breadcrumbs %}
				<li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
				{% endfor %}
			</ul>
		</div>
	</div>
	<div class="container-fluid">
		<!-- <pre>{{ dump(module_megamenu_category) }}</pre> -->
		<form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-module" class="form-horizontal">
			<div class="row">
				<div class="col-md-4 col-md-push-8">
					<div class="panel panel-default" id="panel-data">
						<div class="panel-heading"><h3 class="panel-title"><i class="fa fa-power-off"></i> {{ entry_status }}</h3></div>
						<div class="panel-body">
							<select name="module_megamenu_status" id="input-status" class="selectpicker show-tick" data-width="100%">
								{% if module_megamenu_status %}
								<option value="1" selected="selected">{{ text_enabled }}</option>
								<option value="0">{{ text_disabled }}</option>
								{% else %}
								<option value="1">{{ text_enabled }}</option>
								<option value="0" selected="selected">{{ text_disabled }}</option>
								{% endif %}
							</select>
						</div>
						<div class="panel-footer">
							<div class="row">
								<div class="col-sm-6">
									<a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i class="fa fa-reply"></i> {{ button_cancel }}</a>
								</div>
								<div class="col-sm-6 text-right">
									<button type="submit" form="form-module" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary"><i class="fa fa-save"></i> {{ button_save }}</button>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-md-8 col-md-pull-4">
					<div class="panel panel-default">
						<div class="panel-heading"><h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_edit }}</h3></div>
						<div class="panel-body">
							<ul id="apply-tab" class="nav nav-tabs">
								<li class="active"><a href="#tab-common" data-toggle="tab">Общее</a></li>
								{% if materializeapi %}<li><a href="#tab-info" data-toggle="tab">Информация о шаблоне</a></li>{% endif %}
							</ul>
							<div class="tab-content">
								<div class="tab-pane active" id="tab-common">
									<div class="row">
										<div class="col-sm-3">
											<ul class="nav nav-pills nav-stacked" id="tab-common-pills">
												<li><a href="#tab-categories" data-toggle="tab">Категории</a></li>
												<li><a href="#tab-settings" data-toggle="tab">Настройки</a></li>
											</ul>
										</div>
										<div class="col-sm-9">
											<div class="tab-content">
												<div class="tab-pane" id="tab-categories">
{% for category in categories %}
<div class="panel panel-default" id="panel-image">
	<div class="panel-heading arrow-rotate collapsed" data-toggle="collapse" href="#collapse-{{ category.category_id }}"><h3 class="panel-title">{{ category.name }}</h3></div>
	<div id="collapse-{{ category.category_id }}" class="panel-collapse collapse in"> <!-- Удалить in -->
		<div class="panel-body megamenu-settings">
			<label class="control-label" for="input-sort-order{{ category.category_id }}">Порядок сортировки</label>
			<input type="text" name="module_megamenu_category[{{ category.category_id }}][sort_order]" value="{{ module_megamenu_category[category.category_id].sort_order }}" placeholder="{{ entry_sort_order }}" id="input-sort-order{{ category.category_id }}" class="form-control" />
			<hr>
			<label class="control-label" for="input-megamenu-type{{ category.category_id }}">Тип мега меню</label>
			<select name="module_megamenu_category[{{ category.category_id }}][content_type]" id="input-megamenu-type{{ category.category_id }}" class="selectpicker show-tick" data-width="100%">
			{% for content_type in content_types %}
				{% if module_megamenu_category[category.category_id].content_type == content_type.value %}
				<option value="{{ content_type.value }}" selected="selected">{{ content_type.name }}</option>
				{% else %}
				<option value="{{ content_type.value }}">{{ content_type.name }}</option>
				{% endif %}
			{% endfor %}
			</select>
			<hr>
			<div id="megamenu-content-wrap{{ category.category_id }}">
				<label class="control-label" for="input-megamenu-content{{ category.category_id }}">Контент мега меню</label>
				<select name="module_megamenu_category[{{ category.category_id }}][content_info]" id="input-megamenu-content{{ category.category_id }}" class="selectpicker show-tick" data-width="100%" data-content-info="{{ module_megamenu_category[category.category_id].content_info }}">
				</select>
			</div>
		</div>
	</div>
</div>
{% endfor %}
												</div>
												<div class="tab-pane" id="tab-settings">
													<div class="list-group-item">
														<div class="media">
															<div class="media-body">
																<h4 class="media-heading text-medium">Фиксировать при прокрутке</h4>
																<p>При прокручивании страниц сайта меню будет фиксироваться вверху сайта.</p>
															</div>
															<div class="media-right media-middle">
																<label class="form-switch pull-right">
																	<input name="module_megamenu_settings[fix]" type="checkbox" {{ module_megamenu_settings.fix == 'on' ? 'checked="checked"' }}>
																	<i></i>
																</label>
															</div>
														</div>
													</div>
													<div class="list-group-item">
														<div class="media">
															<div class="media-body">
																<h4 class="media-heading text-medium">Центрировать</h4>
																<p>Список категорий будет фиксироваться по центру. Отключение этой опции позволяет размещать большее количество категорий в одну строку.</p>
															</div>
															<div class="media-right media-middle">
																<label class="form-switch pull-right">
																	<input name="module_megamenu_settings[center]" type="checkbox" {{ module_megamenu_settings.center == 'on' ? 'checked="checked"' }}>
																	<i></i>
																</label>
															</div>
														</div>
													</div>
													<div class="list-group-item">
														<div class="media">
															<div class="media-body">
																<h4 class="media-heading text-medium">Кнопка "Домой"</h4>
																<p>Добавляет в самое начало ссылку на главную страницу сайта.</p>
															</div>
															<div class="media-right media-middle">
																<label class="form-switch pull-right">
																	<input name="module_megamenu_settings[home]" type="checkbox" {{ module_megamenu_settings.home == 'on' ? 'checked="checked"' }}>
																	<i></i>
																</label>
															</div>
														</div>
													</div>
													<div class="list-group-item">
														<div class="media">
															<div class="media-body">
																<h4 class="media-heading text-medium">Заголовок</h4>
																<p>Вверху списка категорий будет заголовок категории со ссылкой на категорию.</p>
															</div>
															<div class="media-right media-middle">
																<label class="form-switch pull-right">
																	<input name="module_megamenu_settings[category_title]" type="checkbox" {{ module_megamenu_settings.category_title == 'on' ? 'checked="checked"' }}>
																	<i></i>
																</label>
															</div>
														</div>
													</div>
													<div class="list-group-item">
														<div class="media">
															<div class="media-body">
																<h4 class="media-heading text-medium">Показать все...</h4>
																<p>Внизу списка категорий будет ссылка с текстом "Показать все Название категории".</p>
															</div>
															<div class="media-right media-middle">
																<label class="form-switch pull-right">
																	<input name="module_megamenu_settings[see_all]" type="checkbox" {{ module_megamenu_settings.see_all == 'on' ? 'checked="checked"' }}>
																	<i></i>
																</label>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								{% if materializeapi %}
								<div class="tab-pane" id="tab-info">
									<div class="row">
										<div class="col-sm-3">
											<ul class="nav nav-pills nav-stacked" id="tab-materializeapi-pills">
												<li><a href="#tab-donaters" data-toggle="tab"><i class="fa fa-birthday-cake"></i> Топ донатеров</a></li>
												<li><a href="#tab-translators" data-toggle="tab"><i class="fa fa-users"></i> Переводчики</a></li>
												<li><a href="#tab-template-versions" data-toggle="tab"><i class="fa fa-code"></i> Версии шаблона</a></li>
												<li><a href="#tab-changelog" data-toggle="tab"><i class="fa fa-asterisk"></i> Список изменений</a></li>
											</ul>
										</div>
										<div class="col-sm-9">
											<div class="tab-content">
												<div class="tab-pane" id="tab-donaters">
													<fieldset>
														<legend>Топ донатеров</legend>
														<div class="table-responsive">
															<table id="donaters" class="table table-striped table-bordered table-hover">
																<thead>
																	<tr>
																		<th>#</th>
																		<th>Изображение</th>
																		<th>Имя</th>
																		<th class="text-center">Сумма доната</th>
																	</tr>
																</thead>
																<tbody>
																	{% set counter_donaters = 1 %}
																	{% for donater in materializeapi_donaters %}
																	<tr>
																		{% if counter_donaters == 1 %}
																		<th scope="row">{{ counter_donaters }}</th>
																		<th class="text-center"><img src="{{ donater.image }}" alt="{{ donater.name }}" class="donaters-image"></th>
																		<td><b>{{ donater.name }}</b></td>
																		<td class="text-center"><span class="label label-danger">{{ donater.amount }} USD</span></td>
																		{% elseif counter_donaters == 2 or counter_donaters == 3 %}
																		<th scope="row">{{ counter_donaters }}</th>
																		<th class="text-center"><img src="{{ donater.image }}" alt="{{ donater.name }}" class="donaters-image"></th>
																		<td><b>{{ donater.name }}</b></td>
																		<td class="text-center"><span class="label label-success">{{ donater.amount }} USD</span></td>
																		{% else %}
																		<th scope="row">{{ counter_donaters }}</th>
																		<th class="text-center"><img src="{{ donater.image }}" alt="{{ donater.name }}" class="donaters-image"></th>
																		<td>{{ donater.name }}</td>
																		<td class="text-center"><span class="label label-primary">{{ donater.amount }} USD</span></td>
																		{% endif %}
																	</tr>
																	{% set counter_donaters = counter_donaters + 1 %}
																	{% endfor %}
																</tbody>
															</table>
														</div>
														<div class="row">
															<div class="col-sm-4 col-sm-offset-8">
																<table class="table table-bordered">
																	<tbody>
																		<tr>
																			<td><b>Всего:</b></td>
																			<td class="text-center"><span class="label label-default">{{ materializeapi_total_amount }} USD</span></td>
																		</tr>
																	</tbody>
																</table>
															</div>
														</div>
													</fieldset>
													<div class="alert alert-info">
														Пожалуйста, поддержите развитие шаблона! <a href="//www.opencart.com/index.php?route=marketplace/extension/info&extension_id=30715" target="_blank" rel="noopener" class="alert-link">Оставьте отзыв</a> а работе или <a href="//paypal.me/trydalcoholic" target="_blank" rel="noopener" class="alert-link">пожертвуйте на развитие</a>.
													</div>
													<hr>
													<div class="form-group">
														<div class="col-xs-12 text-right">
															<div class="btn-group">
																<button type="button" class="btn btn-info" id="cache-clear">Задонатить</button>
																<button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span></button>
																<ul class="dropdown-menu">
																	<li><a href="//paypal.me/trydalcoholic" target="_blank" rel="noopener">PayPal</a></li>
																	<li><a href="//money.yandex.ru/to/41001413377821" target="_blank" rel="noopener">Яндекс.Деньги</a></li>
																</ul>
															</div>
														</div>
													</div>
												</div>
												<div class="tab-pane" id="tab-translators">
													<fieldset>
														<legend>Переводчики</legend>
														<div class="table-responsive">
															<table id="versions" class="table table-striped table-bordered table-hover">
																<thead>
																	<tr>
																		<td>Язык</td>
																		<td>Участники</td>
																	</tr>
																</thead>
																<tbody>
																	{% for translate in materializeapi_translators %}
																	<tr>
																		<td>{{ translate.language }}</td>
																		<td>{{ translate.participants }}</td>
																	</tr>
																	{% endfor %}
																</tbody>
															</table>
														</div>
													</fieldset>
													<div class="alert alert-info">
														Если вы хотите стать участником перевода шаблона, пожалуйста, <a href="//github.com/trydalcoholic/opencart-materialize/issues/20" target="_blank" rel="noopener" class="alert-link">ознакомьтесь с инструкцией здесь</a>.
													</div>
													<hr>
													<div class="form-group">
														<div class="col-xs-12 text-right">
															<div class="btn-group">
																<a href="//github.com/trydalcoholic/opencart-materialize/issues/20" class="btn btn-info" target="_blank" rel="noopener">Помочь</a>
															</div>
														</div>
													</div>
												</div>
												<div class="tab-pane" id="tab-template-versions">
													<fieldset>
														<legend>Версии шаблона</legend>
														<div class="table-responsive">
															<table id="versions" class="table table-striped table-bordered table-hover">
																<thead>
																	<tr>
																		<td>Версия OpenCart</td>
																		<td>Версия шаблона</td>
																		<td>Статус</td>
																	</tr>
																</thead>
																<tbody>
																	{% for version in materializeapi_versions %}
																	<tr>
																		<td>{{ version.opencart }}</td>
																		<td>{{ version.template }}</td>
																		<td>{{ version.status }}</td>
																	</tr>
																	{% endfor %}
																</tbody>
															</table>
														</div>
													</fieldset>
													<div class="alert alert-info">
														Пожалуйста, поддержите развитие шаблона! <a href="//www.opencart.com/index.php?route=marketplace/extension/info&extension_id=30715" target="_blank" rel="noopener" class="alert-link">Оставьте отзыв</a> а работе или <a href="//paypal.me/trydalcoholic" target="_blank" rel="noopener" class="alert-link">пожертвуйте на развитие</a>.
													</div>
													<hr>
													<div class="form-group">
														<div class="col-xs-12 text-right">
															<div class="btn-group">
																<button type="button" class="btn btn-info">Ваша версия <b>{{ materializeapi_template_verstion }}</b></button>
															</div>
														</div>
													</div>
												</div>
												<div class="tab-pane" id="tab-changelog">
													<div class="panel-group" id="accordion-changelog">
														{% set counter_changelogs = 1 %}
														{% for changelog in materializeapi_changelogs %}
														<div class="panel panel-default">
															{% if counter_changelogs == 1 %}
															<div class="panel-heading"><a data-toggle="collapse" data-parent="#accordion-changelog" href="#changelog-version-{{ counter_changelogs }}"><h4 class="panel-title"><b>Version {{ changelog.version }}</b></h4></a></div>
															<div id="changelog-version-{{ counter_changelogs }}" class="panel-collapse collapse in">
																<div class="panel-body">
																	<fieldset>
																		<legend><i class="fa fa-magic"></i> Изменения</legend>
																		{{ changelog.changes }}
																	</fieldset>
																	<fieldset>
																		<legend><i class="fa fa-bug"></i> Исправленные баги</legend>
																		{{ changelog.bags }}
																	</fieldset>
																</div>
															</div>
															{% set counter_changelogs = counter_changelogs + 1 %}
															{% else %}
															<div class="panel-heading"><a class="collapsed" data-toggle="collapse" data-parent="#accordion-changelog" href="#changelog-version-{{ counter_changelogs }}"><h4 class="panel-title">Version {{ changelog.version }}</h4></a></div>
															<div id="changelog-version-{{ counter_changelogs }}" class="panel-collapse collapse">
																<div class="panel-body">
																	<fieldset>
																		<legend><i class="fa fa-magic"></i> Изменения</legend>
																		{{ changelog.changes }}
																	</fieldset>
																	<fieldset>
																		<legend><i class="fa fa-bug"></i> Исправленные баги</legend>
																		{{ changelog.bags }}
																	</fieldset>
																</div>
															</div>
															{% endif %}
														</div>
														{% endfor %}
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								{% endif %}
							</div>
						</div>
						{{ appeal_footer }}
					</div>
				</div>
			</div>
		</form>
	</div>
	{{ installed }}
</div>
<script type="text/javascript">
	$('#tab-common-pills a:first').tab('show');
	{% if materializeapi %}
	$('#tab-materializeapi-pills a:first').tab('show');
	{% endif %}

	var megamenuSettings = $('.megamenu-settings');

	megamenuSettings.each(function(e) {
		e += 1;

		var selectMegamenuType = $(this).find('select[id^=\'input-megamenu-type\']'),
			selectMegamenuContent = $(this).find('select[id^=\'input-megamenu-content\']'),
			megamenuContentWrap = $(this).find('div[id^=\'megamenu-content-wrap\']'),
			dataContentInfo = selectMegamenuContent.data('content-info');

		selectMegamenuType.on('change', function() {
			if ((this.value == 'featured') || (this.value == 'bestseller') || (this.value == 'special') || (this.value == 'html') || (this.value == 'banner')) {
				megamenuContentWrap.find('label').show();
				$.ajax({
					url: 'index.php?route=extension/module/megamenu/megamenuType&content_type=' + this.value + '&user_token={{ user_token }}',
					dataType: 'json',
					beforeSend: function() {
						megamenuContentWrap.find('.bootstrap-select').hide();
						megamenuContentWrap.find('label').after('<div class="loader-wrapper"><div class="showbox"><div class="loader"><svg class="circular" viewBox="25 25 50 50"><circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"/></svg></div></div></div>');
					},
					complete: function() {
						megamenuContentWrap.find('.bootstrap-select').show();
						$('.loader-wrapper').remove();
					},
					success: function(json) {
						if (json != '') {
							for (i = 0; i < json.length; i++) {
								if (i == 0) {
									html = '';
								}

								html += '<option value="' + json[i]['module_id'] + '"';

								if (json[i]['module_id'] == dataContentInfo) {
									html += ' selected="selected"';
								}

								html += '>' + json[i]['name'] + '</option>';
							}
							selectMegamenuContent.html(html);
							megamenuContentWrap.show();
						} else {
							megamenuContentWrap.hide();
						}

						$('.selectpicker').selectpicker('refresh');
					},
					error: function(xhr, ajaxOptions, thrownError) {
						alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					}
				});
			} else {
				megamenuContentWrap.find('label').hide();
				megamenuContentWrap.find('.bootstrap-select').hide();
			}
		});
		$('.selectpicker').selectpicker('refresh');
		selectMegamenuType.trigger('change');
	});

	var successNotification = window.createNotification({
			theme: 'success',
			displayCloseButton: true,
			showDuration: 5000
		}),
		infoNotification = window.createNotification({
			theme: 'info',
			displayCloseButton: true,
			showDuration: 5000
		}),
		warningNotification = window.createNotification({
			theme: 'warning',
			displayCloseButton: true,
			showDuration: 5000
		}),
		errorNotification = window.createNotification({
			theme: 'error',
			displayCloseButton: true,
			showDuration: 5000
		}),
		noneNotification = window.createNotification({
			theme: 'none',
			displayCloseButton: true,
			showDuration: 5000
		});

	// Notify
	{% for error in errors %}
	errorNotification({
		message: '{{ error }}'
	});
	{% endfor %}
</script>
{{ footer }}